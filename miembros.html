<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Miembros - Adoración Viva</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      display: flex;
    }
    .sidebar {
      width: 250px;
      background: #2c3e50;
      color: white;
      padding: 20px;
    }
    .sidebar img {
      width: 100%;
      margin-bottom: 20px;
    }
    .content {
      flex: 1;
      padding: 20px;
      background: #ecf0f1;
    }
    h2 {
      margin-top: 0;
    }
    .toggle-btn {
      background: #2980b9;
      color: white;
      border: none;
      padding: 10px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    form {
      background: white;
      padding: 15px;
      display: none;
      margin-bottom: 20px;
      border-radius: 5px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin: 5px 0;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }
    th, td {
      padding: 10px;
      border: 1px solid #bdc3c7;
      text-align: left;
    }
    th {
      background: #3498db;
      color: white;
    }
    .pagination {
      margin-top: 15px;
      text-align: center;
    }
    .pagination button {
      margin: 0 5px;
      padding: 5px 10px;
      border: none;
      background: #3498db;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <img src="https://azywyqozwwbfctxeokug.supabase.co/storage/v1/object/public/logos//images%20(1).png" alt="Logo" />
    <h3>Adoración Viva</h3>
  </div>
  <div class="content">
    <h2>Gestión de Miembros</h2>
    <button class="toggle-btn" onclick="toggleForm()">Agregar nuevo miembro</button>
    <form id="miembroForm">
      <input type="text" id="nombre" placeholder="Nombre completo" required />
      <input type="text" id="codigo" placeholder="Código" required />
      <input type="number" id="edad" placeholder="Edad" required />
      <input type="text" id="direccion" placeholder="Dirección" required />
      <input type="text" id="sociedad" placeholder="Sociedad" required />
      <button type="submit">Guardar</button>
    </form>

    <table id="miembrosTabla">
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Código</th>
          <th>Edad</th>
          <th>Dirección</th>
          <th>Sociedad</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="pagination" id="pagination"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAyfPQzO7evryWcQ5d1lGV3z8aB-gFOh_k",
      authDomain: "iglesia-adoracion-viva.firebaseapp.com",
      projectId: "iglesia-adoracion-viva",
      storageBucket: "iglesia-adoracion-viva.appspot.com",
      messagingSenderId: "815332010058",
      appId: "1:815332010058:web:d2afff616469349d88deb3",
      measurementId: "G-43MZP6V55D"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const miembroForm = document.getElementById("miembroForm");
    const miembrosTabla = document.getElementById("miembrosTabla").getElementsByTagName("tbody")[0];
    const paginationDiv = document.getElementById("pagination");

    let miembrosData = [];
    const pageSize = 20;
    let currentPage = 1;

    function toggleForm() {
      const form = document.getElementById("miembroForm");
      form.style.display = form.style.display === "none" ? "block" : "none";
    }

    miembroForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const nuevoMiembro = {
        nombre: document.getElementById("nombre").value.trim(),
        codigo: document.getElementById("codigo").value.trim(),
        edad: parseInt(document.getElementById("edad").value),
        direccion: document.getElementById("direccion").value.trim(),
        sociedad: document.getElementById("sociedad").value.trim()
      };
      await addDoc(collection(db, "miembros"), nuevoMiembro);
      miembroForm.reset();
      cargarMiembros();
    });

    async function cargarMiembros() {
      const q = query(collection(db, "miembros"), orderBy("nombre"));
      const querySnapshot = await getDocs(q);
      miembrosData = [];
      querySnapshot.forEach(doc => {
        miembrosData.push(doc.data());
      });
      mostrarPagina(currentPage);
    }

    function mostrarPagina(pagina) {
      miembrosTabla.innerHTML = "";
      currentPage = pagina;
      const inicio = (pagina - 1) * pageSize;
      const fin = inicio + pageSize;
      const paginaDatos = miembrosData.slice(inicio, fin);
      paginaDatos.forEach(miembro => {
        const fila = miembrosTabla.insertRow();
        fila.innerHTML = `
          <td>${miembro.nombre}</td>
          <td>${miembro.codigo}</td>
          <td>${miembro.edad}</td>
          <td>${miembro.direccion}</td>
          <td>${miembro.sociedad}</td>
        `;
      });
      renderizarPaginacion();
    }

    function renderizarPaginacion() {
      paginationDiv.innerHTML = "";
      const totalPaginas = Math.ceil(miembrosData.length / pageSize);
      for (let i = 1; i <= totalPaginas; i++) {
        const btn = document.createElement("button");
        btn.innerText = i;
        btn.onclick = () => mostrarPagina(i);
        if (i === currentPage) btn.style.background = "#2c3e50";
        paginationDiv.appendChild(btn);
      }
    }

    cargarMiembros();
  </script>
</body>
</html>

