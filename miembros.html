<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Miembros - Adoración Viva</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAyfPQzO7evryWcQ5d1lGV3z8aB-gFOh_k",
      authDomain: "iglesia-adoracion-viva.firebaseapp.com",
      databaseURL: "https://iglesia-adoracion-viva-default-rtdb.firebaseio.com",
      projectId: "iglesia-adoracion-viva",
      storageBucket: "iglesia-adoracion-viva.firebasestorage.app",
      messagingSenderId: "815332010058",
      appId: "1:815332010058:web:d2afff616469349d88deb3",
      measurementId: "G-43MZP6V55D"
    };
    
    // Initialize Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore(app);
  </script>
</head>

<body class="bg-gray-100">

  <!-- Sidebar and Header -->
  <div class="flex">
    <div class="w-64 bg-dark-blue p-6">
      <div class="flex justify-between items-center">
        <img class="w-16 h-16 rounded-full" src="https://azywyqozwwbfctxeokug.supabase.co/storage/v1/object/public/logos//images%20(1).png" alt="Logo">
        <button id="toggle-menu" class="text-white">☰</button>
      </div>
      <div id="menu" class="mt-6">
        <ul class="text-white">
          <li><a href="#" class="block py-2 px-4 hover:bg-blue-600">Miembros</a></li>
          <li><a href="#" class="block py-2 px-4 hover:bg-blue-600">Miembros de Baja</a></li>
        </ul>
      </div>
    </div>

    <!-- Main Content -->
    <div class="flex-1 p-8">
      <h2 class="text-3xl font-bold mb-6">Miembros</h2>

      <!-- Button to Add New Member -->
      <div class="flex justify-end mb-4">
        <button id="add-member-btn" class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700">
          Agregar Nuevo Miembro
        </button>
      </div>

      <!-- Table for Active Members -->
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-300 shadow-md rounded-md">
          <thead>
            <tr class="bg-dark-blue text-white">
              <th class="px-4 py-2">Foto</th>
              <th class="px-4 py-2">Nombre Completo</th>
              <th class="px-4 py-2">Código</th>
              <th class="px-4 py-2">Edad</th>
              <th class="px-4 py-2">Dirección</th>
              <th class="px-4 py-2">Sociedad</th>
              <th class="px-4 py-2">Acciones</th>
            </tr>
            <tr class="bg-gray-100">
              <th><input type="text" placeholder="Buscar Foto" class="p-2 border border-gray-300 rounded w-full"></th>
              <th><input type="text" placeholder="Buscar Nombre" class="p-2 border border-gray-300 rounded w-full"></th>
              <th><input type="text" placeholder="Buscar Código" class="p-2 border border-gray-300 rounded w-full"></th>
              <th><input type="text" placeholder="Buscar Edad" class="p-2 border border-gray-300 rounded w-full"></th>
              <th><input type="text" placeholder="Buscar Dirección" class="p-2 border border-gray-300 rounded w-full"></th>
              <th><input type="text" placeholder="Buscar Sociedad" class="p-2 border border-gray-300 rounded w-full"></th>
              <th><input type="text" placeholder="Buscar Acción" class="p-2 border border-gray-300 rounded w-full"></th>
            </tr>
          </thead>
          <tbody id="members-table-body">
            <!-- Rows of members will be inserted here dynamically from Firestore -->
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Add/Edit Member Modal -->
  <div id="member-form-modal" class="fixed inset-0 bg-gray-800 bg-opacity-50 hidden justify-center items-center">
    <div class="bg-white p-6 rounded shadow-lg w-1/3">
      <h3 class="text-2xl font-bold mb-4" id="form-title">Agregar Miembro</h3>
      <form id="member-form" class="space-y-4">
        <div>
          <label for="name" class="block font-medium">Nombre Completo</label>
          <input type="text" id="name" class="w-full p-2 border border-gray-300 rounded" required>
        </div>

        <div>
          <label for="birthday" class="block font-medium">Fecha de Cumpleaños</label>
          <input type="date" id="birthday" class="w-full p-2 border border-gray-300 rounded">
        </div>

        <div>
          <label for="civil-status" class="block font-medium">Estado Civil</label>
          <select id="civil-status" class="w-full p-2 border border-gray-300 rounded">
            <option value="soltero">Soltero</option>
            <option value="casado">Casado</option>
            <option value="divorciado">Divorciado</option>
          </select>
        </div>

        <div>
          <label for="family" class="block font-medium">Familiar</label>
          <select id="family" class="w-full p-2 border border-gray-300 rounded">
            <option value="madre">Mamá</option>
            <option value="padre">Papá</option>
            <option value="hermanos">Hermanos</option>
            <option value="abuelos">Abuelos</option>
          </select>
        </div>

        <div>
          <label for="conversion-date" class="block font-medium">Conversión (Fecha)</label>
          <input type="date" id="conversion-date" class="w-full p-2 border border-gray-300 rounded">
        </div>

        <div>
          <label for="conversion-location" class="block font-medium">Conversión (Lugar)</label>
          <input type="text" id="conversion-location" class="w-full p-2 border border-gray-300 rounded">
        </div>

        <div>
          <label for="baptism-date" class="block font-medium">Bautizo del Espíritu (Fecha)</label>
          <input type="date" id="baptism-date" class="w-full p-2 border border-gray-300 rounded">
        </div>

        <div>
          <label for="baptism-location" class="block font-medium">Bautizo del Espíritu (Ubicación)</label>
          <input type="text" id="baptism-location" class="w-full p-2 border border-gray-300 rounded">
        </div>

        <div class="flex justify-end space-x-4">
          <button type="button" id="close-modal-btn" class="bg-gray-500 text-white px-4 py-2 rounded">Cancelar</button>
          <button type="submit" id="save-member-btn" class="bg-blue-600 text-white px-6 py-3 rounded hover:bg-blue-700">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Firestore logic here

    // Function to fetch and display active members
    function fetchMembers() {
      db.collection("miembros")
        .where("activo", "==", true)
        .onSnapshot(snapshot => {
          const tableBody = document.getElementById("members-table-body");
          tableBody.innerHTML = "";  // Clear the table before adding new rows
          snapshot.forEach(doc => {
            const member = doc.data();
            const row = document.createElement("tr");
            row.innerHTML = `
              <td class="px-4 py-2"><img src="${member.foto}" class="w-12 h-12 rounded-full" alt="Foto"></td>
              <td class="px-4 py-2">${member.nombre}</td>
              <td class="px-4 py-2">${member.codigo}</td>
              <td class="px-4 py-2">${member.edad}</td>
              <td class="px-4 py-2">${member.direccion}</td>
              <td class="px-4 py-2">${member.sociedad}</td>
              <td class="px-4 py-2">
                <button class="edit-btn bg-yellow-500 text-white px-4 py-2 rounded" data-id="${doc.id}">Editar</button>
                <button class="deactivate-btn bg-red-500 text-white px-4 py-2 rounded" data-id="${doc.id}">Dar de Baja</button>
              </td>
            `;
            tableBody.appendChild(row);
          });
        });
    }

    // Function to handle form submission
    document.getElementById("member-form").addEventListener("submit", function (e) {
      e.preventDefault();
      
      const name = document.getElementById("name").value;
      const birthday = document.getElementById("birthday").value;
      const civilStatus = document.getElementById("civil-status").value;
      const family = document.getElementById("family").value;
      const conversionDate = document.getElementById("conversion-date").value;
      const conversionLocation = document.getElementById("conversion-location").value;
      const baptismDate = document.getElementById("baptism-date").value;
      const baptismLocation = document.getElementById("baptism-location").value;

      const newMember = {
        nombre: name,
        fecha_cumpleanos: birthday,
        estado_civil: civilStatus,
        familiar: family,
        fecha_conversion: conversionDate,
        lugar_conversion: conversionLocation,
        fecha_bautizo: baptismDate,
        lugar_bautizo: baptismLocation,
        activo: true,
      };

      // Save the new member to Firestore
      db.collection("miembros").add(newMember).then(() => {
        alert("Miembro agregado exitosamente");
        fetchMembers();
        closeModal();
      });
    });

    // Function to close the modal
    function closeModal() {
      document.getElementById("member-form-modal").classList.add("hidden");
    }

    // Event listener for add new member button
    document.getElementById("add-member-btn").addEventListener("click", function () {
      document.getElementById("form-title").textContent = "Agregar Miembro";
      document.getElementById("member-form").reset();
      document.getElementById("member-form-modal").classList.remove("hidden");
    });

    // Event listener for close modal button
    document.getElementById("close-modal-btn").addEventListener("click", closeModal);

    // Fetch members on page load
    fetchMembers();
  </script>
</body>

</html>
