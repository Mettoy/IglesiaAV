<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n Eclesi√°stica</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h3><span class="highlight">S</span>istema</h3>
            <p>de Gesti√≥n</p>
        </div>
        <nav class="sidebar-nav">
            <a href="inicio.html" class="sidebar-link active">
                <span class="icon">üè†</span> Inicio
            </a>
            <a href="miembro.html" class="sidebar-link">
                <span class="icon">üë•</span> Miembros
            </a>
            <a href="diezmo.html" class="sidebar-link">
                <span class="icon">üí∞</span> Diezmos
            </a>
            <a href="ofrendas.html" class="sidebar-link">
                <span class="icon">ü§≤</span> Ofrendas
            </a>
            <a href="reportes.html" class="sidebar-link">
                <span class="icon">üìä</span> Reportes
            </a>
            <a href="discipulado.html" class="sidebar-link">
                <span class="icon">üìö</span> Discipulado
            </a>
        </nav>
        <div class="logout" onclick="cerrarSesion()">
            <span class="icon">üö™</span> Cerrar sesi√≥n
        </div>
    </div>

    <div class="main-content">
        <header class="top-header">
            <h1>Generador de Reportes <span class="header-icon">üìÑ</span></h1>
            <div class="user-info">
                <span>Bienvenido, Admin</span>
                <img src="https://via.placeholder.com/40/000033/FFFFFF?text=A" alt="Avatar" class="avatar">
            </div>
        </header>

        <div class="dashboard-section">
            <h2>Configuraci√≥n del Reporte</h2>
            <div class="form-group">
                <label for="reportCategory">Selecciona el tipo de reporte:</label>
                <select id="reportCategory" class="form-control">
                    <option value="">-- Selecciona --</option>
                    <option value="miembros">Reporte de Miembros</option>
                    <option value="diezmos">Reporte de Diezmos</option>
                    <option value="ofrendas">Reporte de Ofrendas</option>
                    <option value="discipulado">Reporte de Discipulado</option>
                </select>
            </div>

            <div id="reportOptions" class="report-options-container">
                <p class="placeholder-text">Por favor, selecciona una categor√≠a de reporte para ver las opciones.</p>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="generarReporte()">Generar Reporte</button>
                <button class="btn btn-secondary" onclick="imprimirDocumento()">Imprimir como PDF</button>
            </div>
        </div>

        <div class="report-preview-section">
            <h2>Vista Previa del Reporte <span class="preview-icon">üëÅÔ∏è</span></h2>
            <div id="reportContentToPrint" class="report-content-area">
                <p class="placeholder-text-center">El contenido del reporte aparecer√° aqu√≠. Utiliza el bot√≥n "Generar Reporte" para visualizarlo.</p>
            </div>
        </div>
    </div>

    <script>
        function cerrarSesion() {
            if (confirm('¬øEst√°s seguro de que quieres cerrar sesi√≥n?')) {
                alert('Cerrando sesi√≥n...');
                // Aqu√≠ puedes redirigir al usuario a la p√°gina de login
                window.location.href = 'login.html';
            }
        }

        // Maneja el cambio de selecci√≥n en el tipo de reporte
        document.getElementById('reportCategory').addEventListener('change', function() {
            const optionsDiv = document.getElementById('reportOptions');
            const selectedCategory = this.value;
            optionsDiv.innerHTML = ''; // Limpia opciones anteriores

            if (selectedCategory === 'miembros' || selectedCategory === 'diezmos' || selectedCategory === 'ofrendas') {
                optionsDiv.innerHTML = `
                    <div class="form-group">
                        <label for="startDate">Fecha Inicio:</label>
                        <input type="date" id="startDate" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="endDate">Fecha Fin:</label>
                        <input type="date" id="endDate" class="form-control">
                    </div>
                `;
            } else if (selectedCategory === 'discipulado') {
                optionsDiv.innerHTML = `
                    <div class="form-group">
                        <label for="discipuladoType">Tipo de Discipulado:</label>
                        <select id="discipuladoType" class="form-control">
                            <option value="todos">Todos</option>
                            <option value="bautizados">Bautizados</option>
                            <option value="nuevos">Nuevos Creyentes</option>
                        </select>
                    </div>
                `;
            } else {
                optionsDiv.innerHTML = `<p class="placeholder-text">Por favor, selecciona una categor√≠a de reporte para ver las opciones.</p>`;
            }
        });

        // Funci√≥n para simular la carga de datos del reporte (aqu√≠ ir√≠a tu l√≥gica real)
        function cargarDatosReporte(category, options) {
            let reportHtml = '';
            let title = '';

            switch (category) {
                case 'miembros':
                    title = 'Reporte de Miembros Activos';
                    reportHtml = `
                        <h3>${title}</h3>
                        <p>Periodo: ${options.startDate || 'N/A'} a ${options.endDate || 'N/A'}</p>
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Apellido</th>
                                    <th>Fecha Ingreso</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>001</td><td>Juan</td><td>P√©rez</td><td>2020-01-15</td><td>Activo</td></tr>
                                <tr><td>002</td><td>Mar√≠a</td><td>Gonz√°lez</td><td>2021-03-20</td><td>Activo</td></tr>
                                <tr><td>003</td><td>Pedro</td><td>Ram√≠rez</td><td>2022-07-01</td><td>Inactivo</td></tr>
                                <tr><td>004</td><td>Ana</td><td>L√≥pez</td><td>2023-09-10</td><td>Activo</td></tr>
                            </tbody>
                        </table>
                        <p class="report-footer">Total de miembros activos: 3</p>
                    `;
                    break;
                case 'diezmos':
                    title = 'Reporte de Diezmos Recibidos';
                    reportHtml = `
                        <h3>${title}</h3>
                        <p>Periodo: ${options.startDate || 'N/A'} a ${options.endDate || 'N/A'}</p>
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Miembro</th>
                                    <th>Monto</th>
                                    <th>Descripci√≥n</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>2025-05-01</td><td>Juan P√©rez</td><td>$150.00</td><td>Diezmo Mayo</td></tr>
                                <tr><td>2025-05-08</td><td>Mar√≠a Gonz√°lez</td><td>$100.00</td><td>Diezmo Mayo</td></tr>
                                <tr><td>2025-05-15</td><td>Ana L√≥pez</td><td>$75.00</td><td>Diezmo Mayo</td></tr>
                            </tbody>
                        </table>
                        <p class="report-footer">Total de diezmos en el periodo: $325.00</p>
                    `;
                    break;
                case 'ofrendas':
                    title = 'Reporte de Ofrendas Generales';
                    reportHtml = `
                        <h3>${title}</h3>
                        <p>Periodo: ${options.startDate || 'N/A'} a ${options.endDate || 'N/A'}</p>
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Monto</th>
                                    <th>Tipo de Ofrenda</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>2025-05-05</td><td>$50.00</td><td>General</td></tr>
                                <tr><td>2025-05-12</td><td>$25.00</td><td>Misiones</td></tr>
                                <tr><td>2025-05-19</td><td>$120.00</td><td>Acci√≥n de Gracias</td></tr>
                            </tbody>
                        </table>
                        <p class="report-footer">Total de ofrendas en el periodo: $195.00</p>
                    `;
                    break;
                case 'discipulado':
                    title = `Reporte de Discipulado (${options.discipuladoType || 'Todos'})`;
                    reportHtml = `
                        <h3>${title}</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Nombre del Discipulador</th>
                                    <th>Nombre del Disc√≠pulo</th>
                                    <th>Fase/Nivel</th>
                                    <th>Fecha de Inicio</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>Pastor David</td><td>Juan P√©rez</td><td>Nivel 1</td><td>2024-11-01</td></tr>
                                <tr><td>L√≠der Marta</td><td>Mar√≠a Gonz√°lez</td><td>Nivel 2</td><td>2024-08-15</td></tr>
                                <tr><td>Pastor David</td><td>Ana L√≥pez</td><td>Nuevo Creyente</td><td>2025-04-20</td></tr>
                            </tbody>
                        </table>
                        <p class="report-footer">Total de disc√≠pulos en la categor√≠a ${options.discipuladoType || 'Todos'}: 3</p>
                    `;
                    break;
                default:
                    reportHtml = `<p class="placeholder-text-center">Por favor, selecciona una categor√≠a v√°lida para generar un reporte.</p>`;
                    break;
            }

            document.getElementById('reportContentToPrint').innerHTML = reportHtml;
        }

        // Funci√≥n para generar el reporte y previsualizarlo
        function generarReporte() {
            const category = document.getElementById('reportCategory').value;
            if (!category) {
                alert('Por favor, selecciona una categor√≠a de reporte.');
                return;
            }

            let options = {};
            if (category === 'miembros' || category === 'diezmos' || category === 'ofrendas') {
                options.startDate = document.getElementById('startDate') ? document.getElementById('startDate').value : '';
                options.endDate = document.getElementById('endDate') ? document.getElementById('endDate').value : '';
            } else if (category === 'discipulado') {
                options.discipuladoType = document.getElementById('discipuladoType') ? document.getElementById('discipuladoType').value : '';
            }

            cargarDatosReporte(category, options); // Simula la carga de datos

            // Desplaza a la vista previa del reporte
            document.getElementById('reportContentToPrint').scrollIntoView({ behavior: 'smooth' });
        }

        // Funci√≥n para generar PDF usando html2pdf.js
        function imprimirDocumento() {
            const element = document.getElementById('reportContentToPrint');

            // Verifica si hay contenido real para imprimir
            if (element.innerHTML.trim().includes('placeholder-text-center') || element.innerHTML.trim() === '') {
                alert('No hay contenido de reporte para imprimir. Por favor, genera un reporte primero.');
                return;
            }

            const opt = {
                margin:       1,
                filename:     'reporte_generado.pdf',
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, logging: true, dpi: 192, letterRendering: true },
                jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            // Genera y descarga el PDF
            html2pdf().set(opt).from(element).save();

            alert('Generando y descargando su reporte en PDF...');
        }
    </script>
</body>
</html>
