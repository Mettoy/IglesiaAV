<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Registro de Diezmos - Adoración Viva</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #0d1b2a;
      color: gold;
    }
    header {
      display: flex;
      align-items: center;
      background: #001d3d;
      padding: 10px;
      height: 60px;
      position: fixed;
      top: 0;
      left: 200px;
      right: 0;
      z-index: 1000;
    }
    header img {
      height: 40px;
      margin-right: 10px;
    }
    header h1 {
      margin: 0;
      font-size: 1.2rem;
    }
    #sidebar {
      width: 200px;
      background-color: #003566;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      padding-top: 1rem;
      color: gold;
      overflow: auto;
    }
    #sidebar img {
      display: block;
      margin: 0 auto 10px;
      max-width: 100px;
    }
    #sidebar button {
      background: none;
      border: none;
      color: gold;
      padding: 10px;
      text-align: left;
      width: 100%;
      cursor: pointer;
    }
    .main {
      margin-left: 200px;
      padding: 80px 20px 20px;
    }
    .form-toggle {
      background: green;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      margin-bottom: 10px;
      font-weight: bold;
    }
    .form-container {
      display: none;
      background: #1b263b;
      padding: 20px;
      border-radius: 8px;
    }
    label {
      display: block;
      margin: 10px 0 5px;
      color: white;
    }
    select, input {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
      border: none;
      background: #e0e0e0;
      color: black;
    }
    button.save-btn {
      background: #003566;
      color: gold;
      border: none;
      padding: 10px 20px;
      font-weight: bold;
      cursor: pointer;
    }
    .tools {
      margin: 20px 0 10px;
    }
    .tools button {
      margin-right: 10px;
      background: #ffc300;
      color: black;
      border: none;
      padding: 10px;
      cursor: pointer;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      background: #1b263b;
      color: white;
    }
    th, td {
      border: 1px solid gold;
      padding: 10px;
      text-align: center;
    }
    .search-bar {
      width: 100%;
      margin-bottom: 10px;
      padding: 5px;
    }
    img.foto {
      width: 50px;
      height: 50px;
      border-radius: 50%;
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <img id="logo" src="logo.png" alt="Logo" />
    <input type="file" id="logoInput" style="display:none" />
    <button onclick="cambiarLogo()">Cambiar Logo</button>
    <script>
      const rol = 'ADMON';
      function cambiarLogo() {
        if (rol !== 'ADMON') return alert('Solo el administrador puede cambiar el logo');
        document.getElementById('logoInput').click();
      }
      document.getElementById('logoInput').addEventListener('change', e => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = () => {
            document.getElementById('logo').src = reader.result;
            localStorage.setItem('logo', reader.result);
          };
          reader.readAsDataURL(file);
        }
      });
      window.onload = () => {
        const savedLogo = localStorage.getItem('logo');
        if (savedLogo) document.getElementById('logo').src = savedLogo;
      };
    </script>
  </div>

  <header>
    <img id="logoHeader" src="logo.png" alt="Logo" />
    <h1>Informe ADORACIÓN VIVA</h1>
  </header>

  <div class="main">
    <button class="form-toggle" onclick="toggleFormulario()">Añadir Diezmo</button>

    <div class="form-container" id="formulario">
      <label>Buscar Miembro</label>
      <input type="text" oninput="filtrarMiembros(this.value)">
      
      <label>Seleccionar Miembro</label>
      <select id="miembro" onchange="mostrarDatosMiembro()">
        <option value="">Seleccione un miembro</option>
      </select>

      <div id="datosMiembro"></div>

      <label>Fecha</label>
      <input type="date" id="fecha">

      <label>Cantidad (C$ o $)</label>
      <input type="text" id="cantidad" placeholder="Ej. C$100 o $20">

      <button class="save-btn" onclick="guardarRegistro()">Guardar</button>
    </div>

    <div class="tools">
      <button onclick="generarPDF()">Imprimir Hoja PDF</button>
      <button onclick="generarExcel()">Exportar a Excel</button>
    </div>

    <table id="tabla">
      <thead>
        <tr>
          <th>#<br><input class="search-bar" oninput="filtrarTabla(0, this.value)" /></th>
          <th>Foto<br><input class="search-bar" disabled /></th>
          <th>Nombre<br><input class="search-bar" oninput="filtrarTabla(2, this.value)" /></th>
          <th>Código<br><input class="search-bar" oninput="filtrarTabla(3, this.value)" /></th>
          <th>Edad<br><input class="search-bar" oninput="filtrarTabla(4, this.value)" /></th>
          <th>Fecha<br><input class="search-bar" oninput="filtrarTabla(5, this.value)" /></th>
          <th>Cantidad<br><input class="search-bar" oninput="filtrarTabla(6, this.value)" /></th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const miembros = [
      { nombre: "Juan Pérez", codigo: "123", edad: 30, foto: "https://via.placeholder.com/50" },
      { nombre: "Ana Gómez", codigo: "456", edad: 25, foto: "https://via.placeholder.com/50" }
    ];

    const registros = [];

    miembros.forEach(m => {
      const opt = document.createElement("option");
      opt.value = m.codigo;
      opt.textContent = `${m.nombre} (${m.codigo})`;
      document.getElementById("miembro").appendChild(opt);
    });

    function toggleFormulario() {
      const f = document.getElementById("formulario");
      f.style.display = f.style.display === "none" || !f.style.display ? "block" : "none";
    }

    function filtrarMiembros(texto) {
      const select = document.getElementById("miembro");
      [...select.options].forEach(opt => {
        if (opt.value === "") return;
        opt.style.display = opt.textContent.toLowerCase().includes(texto.toLowerCase()) ? "block" : "none";
      });
    }

    function mostrarDatosMiembro() {
      const codigo = document.getElementById("miembro").value;
      const miembro = miembros.find(m => m.codigo === codigo);
      const div = document.getElementById("datosMiembro");
      if (miembro) {
        div.innerHTML = `
          <img class="foto" src="${miembro.foto}" />
          <p><strong>Nombre:</strong> ${miembro.nombre}</p>
          <p><strong>Código:</strong> ${miembro.codigo}</p>
          <p><strong>Edad:</strong> ${miembro.edad}</p>
        `;
      } else {
        div.innerHTML = "";
      }
    }

    function guardarRegistro() {
      const codigo = document.getElementById("miembro").value;
      const miembro = miembros.find(m => m.codigo === codigo);
      const fecha = document.getElementById("fecha").value;
      const cantidad = document.getElementById("cantidad").value;
      if (!miembro || !fecha || !cantidad) return alert("Completa todos los campos");

      registros.push({ ...miembro, fecha, cantidad });
      actualizarTabla();
    }

    function actualizarTabla() {
      const tbody = document.querySelector("#tabla tbody");
      tbody.innerHTML = "";
      registros.forEach((r, i) => {
        const fila = `
          <tr>
            <td>${i + 1}</td>
            <td><img class="foto" src="${r.foto}" /></td>
            <td>${r.nombre}</td>
            <td>${r.codigo}</td>
            <td>${r.edad}</td>
            <td>${r.fecha}</td>
            <td>${r.cantidad}</td>
          </tr>`;
        tbody.innerHTML += fila;
      });
    }

    function filtrarTabla(col, val) {
      const rows = document.querySelectorAll("#tabla tbody tr");
      rows.forEach(row => {
        const cell = row.children[col];
        row.style.display = cell.textContent.toLowerCase().includes(val.toLowerCase()) ? "" : "none";
      });
    }

    function generarPDF() {
      alert("Aquí se genera un PDF con encabezado, logo y agrupado por mes.");
      // Aquí puedes usar jsPDF o pdf-lib para crear el PDF con el logo y título
    }

    function generarExcel() {
      alert("Aquí se genera un archivo Excel con los registros.");
      // Aquí puedes usar SheetJS para exportar a Excel
    }
  </script>
</body>
</html>