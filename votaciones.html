<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Votaciones - Sistema Real</title>
<style>
  body {
    background: #0b0c2a;
    color: #f7c948;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 20px;
  }
  h1, h2 {
    text-align: center;
    margin-bottom: 20px;
  }
  .container {
    max-width: 1000px;
    margin: auto;
  }
  /* Formulario agregar evento */
  #nuevoEventoForm {
    background: #14153a;
    padding: 15px 20px;
    border-radius: 10px;
    margin-bottom: 30px;
    box-shadow: 0 0 10px #f7c94888;
  }
  #nuevoEventoForm input[type="text"] {
    width: 30%;
    padding: 8px;
    margin-right: 10px;
    border-radius: 5px;
    border: none;
    font-size: 16px;
  }
  #nuevoEventoForm input[type="number"] {
    width: 15%;
    padding: 8px;
    margin-right: 10px;
    border-radius: 5px;
    border: none;
    font-size: 16px;
  }
  #nuevoEventoForm button {
    background: #f7c948;
    border: none;
    color: #0b0c2a;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #nuevoEventoForm button:hover {
    background: #d1a52f;
  }
  /* Evento cards */
  .event-card {
    background: #14153a;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: 0 0 10px #f7c948aa;
  }
  .event-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
  }
  .event-title {
    font-size: 1.3rem;
    font-weight: 700;
  }
  .event-buttons button {
    background: #f7c948;
    border: none;
    color: #0b0c2a;
    padding: 8px 15px;
    border-radius: 8px;
    font-weight: bold;
    margin-left: 10px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .event-buttons button:hover {
    background: #d1a52f;
  }
  /* Tabla votos */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    border: 1px solid #f7c94866;
    padding: 8px 12px;
    text-align: center;
  }
  th {
    background: #f7c94822;
  }
  input[type=number] {
    width: 60px;
    font-size: 1rem;
    padding: 4px;
    border-radius: 6px;
    border: none;
    text-align: center;
  }
  /* Resultados */
  #resultados {
    margin-top: 40px;
  }
  #resultados h2 {
    margin-bottom: 15px;
  }
  .resultado-card {
    background: #14153a;
    border-radius: 12px;
    padding: 15px 20px;
    margin-bottom: 20px;
    box-shadow: 0 0 12px #f7c948cc;
  }
  .resultado-title {
    font-weight: 700;
    margin-bottom: 10px;
  }
</style>
</head>
<body>
  <div class="container">
    <h1>Sistema de Votaciones Real</h1>

    <form id="nuevoEventoForm">
      <input type="text" id="nombreEvento" placeholder="Nombre del Evento" required />
      <input type="text" class="opcion" placeholder="Opción 1" required />
      <input type="text" class="opcion" placeholder="Opción 2" required />
      <input type="text" class="opcion" placeholder="Opción 3" />
      <input type="text" class="opcion" placeholder="Opción 4" />
      <button type="submit">Agregar Evento</button>
    </form>

    <div id="eventosContainer"></div>

    <div id="resultados">
      <h2>Resultados Finalizados</h2>
      <div id="resultadosContainer"></div>
    </div>
  </div>

<script>
  const form = document.getElementById('nuevoEventoForm');
  const eventosContainer = document.getElementById('eventosContainer');
  const resultadosContainer = document.getElementById('resultadosContainer');

  // Estado de eventos: 
  // { id, nombre, opciones: [{nombre, votos}], estado: 'pendiente' | 'enCurso' | 'finalizado' }
  let eventos = [];
  let idEvento = 0;

  form.addEventListener('submit', e => {
    e.preventDefault();

    const nombre = document.getElementById('nombreEvento').value.trim();
    if (!nombre) return alert('Debe ingresar un nombre para el evento');

    // Obtener opciones no vacías
    const opcionesInputs = Array.from(form.querySelectorAll('.opcion'));
    const opciones = opcionesInputs
      .map(i => i.value.trim())
      .filter(op => op !== '')
      .map(op => ({ nombre: op, votos: 0 }));

    if (opciones.length < 2) return alert('Debe ingresar al menos dos opciones para votar.');

    // Crear nuevo evento
    const nuevoEvento = {
      id: idEvento++,
      nombre,
      opciones,
      estado: 'pendiente'
    };
    eventos.push(nuevoEvento);

    form.reset();
    renderEventos();
  });

  function renderEventos() {
    eventosContainer.innerHTML = '';
    eventos.forEach(evento => {
      const card = document.createElement('div');
      card.classList.add('event-card');

      const header = document.createElement('div');
      header.classList.add('event-header');

      const title = document.createElement('div');
      title.classList.add('event-title');
      title.textContent = evento.nombre;

      const buttonsDiv = document.createElement('div');
      buttonsDiv.classList.add('event-buttons');

      if (evento.estado === 'pendiente') {
        const btnIniciar = document.createElement('button');
        btnIniciar.textContent = 'Iniciar';
        btnIniciar.onclick = () => iniciarEvento(evento.id);
        buttonsDiv.appendChild(btnIniciar);
      }

      if (evento.estado === 'enCurso') {
        const btnFinalizar = document.createElement('button');
        btnFinalizar.textContent = 'Finalizar';
        btnFinalizar.onclick = () => finalizarEvento(evento.id);
        buttonsDiv.appendChild(btnFinalizar);
      }

      header.appendChild(title);
      header.appendChild(buttonsDiv);

      card.appendChild(header);

      if (evento.estado === 'enCurso') {
        // Mostrar tabla editable votos
        const tabla = document.createElement('table');
        const thead = document.createElement('thead');
        const trHead = document.createElement('tr');
        trHead.innerHTML = '<th>Opción</th><th>Votos</th>';
        thead.appendChild(trHead);
        tabla.appendChild(thead);

        const tbody = document.createElement('tbody');
        evento.opciones.forEach((opcion, idx) => {
          const tr = document.createElement('tr');

          const tdNombre = document.createElement('td');
          tdNombre.textContent = opcion.nombre;

          const tdVotos = document.createElement('td');
          const inputVotos = document.createElement('input');
          inputVotos.type = 'number';
          inputVotos.min = 0;
          inputVotos.value = opcion.votos;
          inputVotos.oninput = e => {
            const val = parseInt(e.target.value);
            if (isNaN(val) || val < 0) {
              e.target.value = 0;
              evento.opciones[idx].votos = 0;
            } else {
              evento.opciones[idx].votos = val;
            }
          };

          tdVotos.appendChild(inputVotos);
          tr.appendChild(tdNombre);
          tr.appendChild(tdVotos);
          tbody.appendChild(tr);
        });

        tabla.appendChild(tbody);
        card.appendChild(tabla);
      }

      eventosContainer.appendChild(card);
    });

    renderResultados();
  }

  function iniciarEvento(id) {
    const evento = eventos.find(e => e.id === id);
    if (evento) {
      evento.estado = 'enCurso';
      renderEventos();
    }
  }

  function finalizarEvento(id) {
    const evento = eventos.find(e => e.id === id);
    if (evento) {
      evento.estado = 'finalizado';
      renderEventos();
    }
  }

  function renderResultados() {
    resultadosContainer.innerHTML = '';

    const finalizados = eventos.filter(e => e.estado === 'finalizado');
    if(finalizados.length === 0) {
      resultadosContainer.innerHTML = '<p>No hay resultados finalizados aún.</p>';
      return;
    }

    finalizados.forEach(evento => {
      const card = document.createElement('div');
      card.classList.add('resultado-card');

      const title = document.createElement('div');
      title.classList.add('resultado-title');
      title.textContent = evento.nombre;

      const tabla = document.createElement('table');
      const thead = document.createElement('thead');
      const trHead = document.createElement('tr');
      trHead.innerHTML = '<th>Opción</th><th>Votos</th>';
      thead.appendChild(trHead);
      tabla.appendChild(thead);

      const tbody = document.createElement('tbody');
      evento.opciones.forEach(opcion => {
        const tr = document.createElement('tr');
        const tdNombre = document.createElement('td');
        tdNombre.textContent = opcion.nombre;

        const tdVotos = document.createElement('td');
        tdVotos.textContent = opcion.votos;

        tr.appendChild(tdNombre);
        tr.appendChild(tdVotos);
        tbody.appendChild(tr);
      });

      tabla.appendChild(tbody);

      card.appendChild(title);
      card.appendChild(tabla);

      resultadosContainer.appendChild(card);
    });
  }

  // Primera renderización
  renderEventos();
</script>

</body>
</html>
